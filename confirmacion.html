<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Confirmaci√≥n | Yoseba & Ana</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .btn-reject {
      background-color: #f8f9fa;
      color: #dc3545;
      border: 1px solid #dc3545;
    }
    .btn-reject:hover {
      background-color: #dc3545;
      color: white;
    }
  </style>
</head>
<body>

<nav class="centered-nav fixed-top">
  <div class="container text-center">
    <a class="nav-brand-title d-block" href="index.html">Yoseba & Ana</a>
    
    <ul class="nav-links list-unstyled d-flex justify-content-center border-top">
      <li class="nav-item">
        <a class="nav-link nav-box" href="index.html">¬°Bienvenidos!</a>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-box" href="itinerario.html">El Gran D√≠a</a>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-box active" href="confirmacion.html">Confirmaci√≥n</a>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-box" href="fotos.html">√Ålbum</a>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-box" href="agradecimiento.html">Agradecimiento</a>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-box" href="novedades.html">√öltimas Novedades</a>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-box" href="#contacto">Contacto</a>
      </li>
    </ul>
  </div>
</nav>

<div class="container mt-5 pt-5"> 
  <h1 class="text-center mb-4">CONFIRMACI√ìN</h1>

  <div class="content-panel mx-auto" style="max-width: 1000px;">
    <p class="text-center">
      Para confirmar tu asistencia a la boda s√≥lo tienes que indicar lo que te une a nosotros, seleccionar tu nombre en la lista y rellenar tu tel√©fono. 
      Si lamentablemente no puedes venir, pulsa el bot√≥n <strong>"No podr√© asistir"</strong> para que podamos tenerlo en cuenta.
    </p>
  </div>

  <div id="formConfirmacion" class="mx-auto custom-form-box mb-5 shadow-sm" style="max-width:500px;">
    <label class="form-label small fw-bold">1. Escribe tu nombre</label>
    <div class="position-relative mb-3">
        <input type="text" id="buscadorNombre" class="form-control" placeholder="Escribe tu nombre" autocomplete="off">
        <ul id="listaSugerencias" class="list-group position-absolute w-100 shadow-sm" style="z-index: 1000; display: none; max-height: 200px; overflow-y: auto;">
        </ul>
        <input type="hidden" id="nombreReal" required>
    </div>

    <label class="form-label small fw-bold">2. Tel√©fono m√≥vil</label>
    <input type="tel" id="telefono" class="form-control mb-3" 
       placeholder="Ej: 600000000" 
       pattern="[0-9]{9}" 
       maxlength="9" 
       required title="El tel√©fono debe tener 9 n√∫meros">

    <label class="form-label small fw-bold">4. Dedicatoria (opcional)</label>
    <textarea id="mensaje" class="form-control mb-3" rows="3" placeholder="Escribe algo para los novios..."></textarea>

    <div class="row g-2">
      <div class="col-md-7">
        <button type="submit" id="btnConfirmar" class="btn btn-primary w-100 py-2">Confirmar asistencia</button>
      </div>
      <div class="col-md-5">
        <button type="button" id="btnNegar" class="btn btn-reject w-100 py-2">No podr√© asistir</button>
      </div>
    </div>
  </div>
</div>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbxZMRGkywXDGbRGYFVFYE7RXZe3HkBlX6ywrK5F1KIPPUS919gXT3baOnDXdKn3F22n/exec'; 
  let invitados = [];

  const buscador = document.getElementById('buscadorNombre');
  const listaSugerencias = document.getElementById('listaSugerencias');
  const nombreReal = document.getElementById('nombreReal');

  // Cargar datos al inicio
  window.addEventListener('DOMContentLoaded', () => {
    fetch(scriptURL)
      .then(res => res.json())
      .then(data => { invitados = data; })
      .catch(err => console.error("Error cargando invitados", err));
  });

  // L√≥gica del buscador
  buscador.addEventListener('input', (e) => {
    const texto = e.target.value.toLowerCase().trim();
    listaSugerencias.innerHTML = '';
    
    if (texto.length < 2) { // Empezar a buscar tras 2 letras
      listaSugerencias.style.display = 'none';
      return;
    }

    // Filtra nombres que CONTENGAN lo escrito (Adri encontrar√° Adri√°n)
    const coincidencias = invitados.filter(i => 
      i.nombre.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(texto)
    );

    if (coincidencias.length > 0) {
      coincidencias.forEach(i => {
        const li = document.createElement('li');
        li.className = 'list-group-item list-group-item-action cursor-pointer';
        li.style.cursor = 'pointer';
        li.textContent = i.nombre;
        li.onclick = () => {
          buscador.value = i.nombre;
          nombreReal.value = i.nombre; // Guardamos el nombre exacto de la Excel
          listaSugerencias.style.display = 'none';
        };
        listaSugerencias.appendChild(li);
      });
      listaSugerencias.style.display = 'block';
    } else {
      listaSugerencias.style.display = 'none';
    }
  });

  // Cerrar lista si se pincha fuera
  document.addEventListener('click', (e) => {
    if (e.target !== buscador) listaSugerencias.style.display = 'none';
  });

  function enviar(asistencia) {
    const nombre = nombreReal.value;
    const telefono = document.getElementById('telefono').value;

    if (!nombre) {
      alert("Por favor, selecciona tu nombre de la lista desplegable.");
      return;
    }
    if (telefono.length < 9) {
      alert("Introduce un tel√©fono v√°lido.");
      return;
    }

    const btnC = document.getElementById('btnConfirmar');
    const btnN = document.getElementById('btnNegar');
    btnC.disabled = btnN.disabled = true;
    btnC.textContent = "Enviando...";

    const params = new URLSearchParams({
      nombre: nombre,
      telefono: telefono,
      mensaje: document.getElementById('mensaje').value,
      asistencia: asistencia
    });

    fetch(scriptURL + '?' + params.toString(), { method: 'POST' })
      .then(() => {
        alert(asistencia === 'S√ç' ? '¬°Confirmado! Nos vemos pronto.' : 'Entendido, te echaremos de menos.');
        location.reload();
      })
      .catch(() => {
        alert("Error al enviar. Int√©ntalo de nuevo.");
        btnC.disabled = btnN.disabled = false;
        btnC.textContent = "Confirmar asistencia";
      });
  }

  document.getElementById('btnConfirmar').onclick = () => enviar('S√ç');
  document.getElementById('btnNegar').onclick = () => enviar('NEGADO');
</script>

<footer id="contacto" class="py-4 border-top">
  <div class="container text-center">
    <p class="mb-2">
      <a href="index.html" class="text-decoration-none text-muted mx-2">¬°Bienvenidos!</a> |
      <a href="itinerario.html" class="text-decoration-none text-muted mx-2">El Gran D√≠a</a> |
      <a href="confirmacion.html" class="text-decoration-none text-muted mx-2">Confirmaci√≥n</a> |
      <a href="fotos.html" class="text-decoration-none text-muted mx-2">√Ålbum</a> |
      <a href="agradecimiento.html" class="text-decoration-none text-muted mx-2">Agradecimiento</a> |
      <a href="novedades.html" class="text-decoration-none text-muted mx-2">√öltimas Novedades</a>
    </p>

    <div class="small text-muted mb-2">¬© 2026 Yoseba & Ana</div>

    <div class="small text-muted">
      <a href="mailto:anacarmonacordoba@gmail.com" class="text-decoration-none text-dark">anacarmonacordoba@gmail.com</a> | üì± 692 260 215
    </div>

    <div class="small text-muted">
      <a href="mailto:garciapardoyoseba@gmail.com" class="text-decoration-none text-dark">garciapardoyoseba@gmail.com</a> | üì± 611 459 193
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="main.js"></script>
<link rel="stylesheet" href="styles.css">
</body>
</html>
